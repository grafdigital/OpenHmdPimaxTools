import hid
import sys
from time import sleep
from datetime import datetime
import math
import numpy as np
import matplotlib.pyplot as plt

vid = 0x0483
pid = 0x0021

BUFFER_SIZE=256

with hid.Device(vid, pid) as h:
    print(f'Device manufacturer: {h.manufacturer}')
    print(f'Product: {h.product}')
    print(f'Serial Number: {h.serial}')

    sleep(1)

    device_status_report = h.get_feature_report(240, 64) # Get Device Status Report
    print(device_status_report.hex())

    current_reso = device_status_report[24]
    print('Current Resolution: ' + ('high' if current_reso == 5 else 'low'))

    reso_target = sys.argv[1]

    if reso_target == 'read':
        exit(0)

    #h.send_feature_report(b'\x11\x00\x00\x0b\x10\x27')

    if reso_target == 'high':
        #Set Reso High
        print('send high')
        resp = h.send_feature_report( b'\xf0\x00\x00\x02\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x05\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00' )
    else:
        #Set Reso Low
        print('send low')
        resp = h.send_feature_report( b'\xf0\x00\x00\x02\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x04\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00' )

    print(resp)

    sleep(3)

    #Restart HMD
    resp = h.send_feature_report( b'\xf0\x00\x00\x03\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00' )

    print(resp)

    h.close()
